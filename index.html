<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Fury</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <style>
    .round, .player {
        position: absolute;
    }
    body {
        overflow: hidden;
    }
  </style>
    <body>
        <div id="board">
        </div>
      </body>
  <script>
    (()=>{
        const boardDom = document.getElementById('board');

        const getCoordinatesFromVector = (vector) => {
            return {
                x: Math.cos(vector.degrees * (3.14/180)) * vector.distance,
                y: Math.sin(vector.degrees * (3.14/180)) * vector.distance
            };
        };

        const drawDom = (data) => {
            if (data.x > 100 || data.y > 100 || data.x < 0 || data.y < 0) {
                const dom = document.getElementById(data.id);
                if (dom) {
                    boardDom.removeChild(dom);
                }
            } else {
                var dom = document.getElementById(data.id);
                if (!dom) {
                    if (data.type === 'player') {
                        dom = createPlayerDom(data);
                    } else if (data.type === 'round') {
                        dom = createRoundDom(data);
                    }
                }
                dom.style.left = `${data.x}%`;
                dom.style.top = `${data.y}%`;

                if(data.died) {
                    dom.innerText = '💀';
                }
            }
        };

        const createDom = (data, className) => {
            const dom = document.createElement('div');
            dom.id = data.id;
            dom.classList.add(className);
            boardDom.appendChild(dom);
            return dom;
        };

        const createRoundDom = (data) => {
            const dom = createDom(data, 'round');
            dom.innerText = `💥`;
            return dom;
        };

        const createPlayerDom = (data) => {
            const dom = createDom(data, 'player');
            dom.innerText = `🧍`;
            return dom;
        };

        const gameData = {
            rounds: [{ type: 'round', id: 100, x: 50, y: 50, degrees: 210, distance: 3 }],
            players: [
                { type: 'player', id: 1, x: 50, y: 50, degrees: 90, distance: .5 },
                { type: 'player', id: 2, x: 70, y: 70, degrees: 110, distance: .5 }

            ]
        };

        const intervalId = setInterval(() => {

            [...gameData.rounds, ...gameData.players].forEach(a => {
                const updated = getCoordinatesFromVector(a);
                a.x = a.x + updated.x;
                a.y = a.y + updated.y;
            });

            //gameData.rounds = gameData.rounds.filter(r => r.x > 0 && r.x < 100 && r.y > 0 && r.y < 100);

            gameData.rounds.forEach(r => {
                gameData.players.every(p => {
                    if(Math.round(p.x) === Math.round(r.x) && Math.round(p.y) === Math.round(r.y)) {
                        p.died = true;
                    } 
                });
            });
            
            [...gameData.rounds, ...gameData.players].forEach(a => drawDom(a));
        }, 100);

        const shootIntervalId = setInterval(() => {
            gameData.players.forEach(p => {
                gameData.rounds.push({
                    id: 100 + gameData.rounds.length,
                    type: 'round',
                    x: p.x,
                    y: p.y,
                    degrees: p.degrees,
                    distance: 3
                });
            });
         }, 1000);
        
        document.addEventListener('keypress', (event) => {
            const updatePlayer = (playerId) => {
                const player = gameData.players[playerId];
                if(!player.died) {
                    player.degrees = player.degrees + 10; 
                } 
            };
            if(event.code === 'KeyA') {
                updatePlayer(0);
            } else if(event.code === 'KeyL') {
                updatePlayer(1);
            }
        });

    })();
  </script>
</html>
